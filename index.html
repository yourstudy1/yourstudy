<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study OS</title>

<style>
body{
margin:0;
font-family:Arial;
background:#111;
color:white;
overflow:hidden;
transition:0.5s;
}

/* NORMAL DASHBOARD */
#dashboard{
padding:20px;
}

.card{
background:rgba(255,255,255,0.05);
backdrop-filter:blur(10px);
padding:20px;
border-radius:15px;
margin-bottom:15px;
}

button{
padding:8px 15px;
border:none;
border-radius:8px;
cursor:pointer;
background:#444;
color:white;
}

button:hover{
background:#666;
}

/* TAB MODE */
#tabMode{
display:none;
height:100vh;
width:100vw;
position:relative;
text-align:center;
background-size:cover;
background-position:center;
}

#clock{
font-size:70px;
margin-top:40px;
}

#subject{
font-size:45px;
margin-top:15vh;
}

#remaining{
font-size:30px;
margin-top:10px;
}

#warningBox{
margin-top:20px;
}

.red{color:red;}
.orange{color:orange;}

#exitBtn{
position:absolute;
bottom:15px;
right:20px;
font-size:12px;
background:rgba(0,0,0,0.5);
}
</style>
</head>
<body>

<!-- DASHBOARD -->
<div id="dashboard">
<h2>Smart Study Dashboard</h2>

<div class="card">
<h3>Live Time</h3>
<div id="normalClock"></div>
</div>

<div class="card">
<h3>Status</h3>
<div id="status">Idle</div>
</div>

<button onclick="enableTab()">Enter Tab Mode</button>
<a href="admin.html"><button>Admin</button></a>

</div>

<!-- TAB MODE -->
<div id="tabMode">

<div id="clock"></div>

<div id="subject"></div>
<div id="remaining"></div>

<div id="warningBox"></div>

<button id="exitBtn" onclick="disableTab()">EXIT</button>

</div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbxq49CFhIWiKHxh69xPBczmBuiMcjw5YIoYuEq6lwZYybsAZWuG2Q9q8guseFWTa2Wd0A/exec";

/* WALLPAPER */
function changeWallpaper(){
const url="https://picsum.photos/1600/900?random="+Date.now();
document.getElementById("tabMode").style.backgroundImage="url('"+url+"')";
}
changeWallpaper();
setInterval(changeWallpaper,900000);

/* CLOCK */
setInterval(()=>{
let now=new Date();
document.getElementById("normalClock").innerText=now.toLocaleTimeString();
document.getElementById("clock").innerText=now.toLocaleTimeString();
},1000);

/* TAB MODE */
function enableTab(){
document.getElementById("dashboard").style.display="none";
document.getElementById("tabMode").style.display="block";
}
function disableTab(){
document.getElementById("dashboard").style.display="block";
document.getElementById("tabMode").style.display="none";
}

/* ROUTINE */
let routine=[];
try{
routine=JSON.parse(localStorage.getItem("routine"))||[];
}catch(e){
routine=[];
}

let activeIndex=-1;
let warningTimer;
let studyTimer;
let warningSeconds=0;
let studySeconds=0;

/* CHECK SCHEDULE */
setInterval(checkSchedule,1000);

function checkSchedule(){

let now=new Date();

routine.forEach((item,index)=>{

let [h,m]=item.time.split(":");
let start=new Date();
start.setHours(h);
start.setMinutes(m);
start.setSeconds(0);

let diff=Math.floor((start-now)/60000);

/* 10 MIN BEFORE */
if(diff===10 && activeIndex!==index){
preWarning(index,item);
}

});

}

/* PRE WARNING */
function preWarning(index,item){

activeIndex=index;
warningSeconds=600;

document.getElementById("subject").innerText="Upcoming: "+item.subject;
document.getElementById("subject").className="orange";

document.getElementById("warningBox").innerHTML=
"<button onclick='startNow()'>Start</button>"+
"<button onclick='cancelNow()'>Cancel</button>"+
"<button onclick='sameSubject()'>Same</button>";

fetch(scriptURL,{
method:"POST",
body:new URLSearchParams({
type:"warning",
subject:item.subject,
message:"Starting in 10 Minutes"
})
});

clearInterval(warningTimer);
warningTimer=setInterval(()=>{

warningSeconds--;

let m=Math.floor(warningSeconds/60);
let s=warningSeconds%60;

document.getElementById("remaining").innerText=
"Warning: "+m+":"+String(s).padStart(2,"0");

if(warningSeconds<=0){
cancelNow();
}

},1000);

}

/* START */
function startNow(){
clearInterval(warningTimer);
startStudy(routine[activeIndex]);
}

/* SAME */
function sameSubject(){
clearInterval(warningTimer);
startStudy(routine[activeIndex]);
}

/* CANCEL */
function cancelNow(){
clearInterval(warningTimer);
clearInterval(studyTimer);
document.getElementById("subject").innerText="CANCELLED";
document.getElementById("subject").className="red";
document.getElementById("remaining").innerText="";
document.getElementById("warningBox").innerHTML="";
}

/* STUDY */
function startStudy(item){

studySeconds=item.duration*60;
document.getElementById("subject").innerText=item.subject;
document.getElementById("subject").className="";

clearInterval(studyTimer);

studyTimer=setInterval(()=>{

studySeconds--;

let m=Math.floor(studySeconds/60);
let s=studySeconds%60;

document.getElementById("remaining").innerText=
"Study: "+m+":"+String(s).padStart(2,"0");

if(studySeconds<=0){
cancelNow();
}

},1000);

}

</script>
</body>
</html>
