<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study OS</title>

<style>
body{
margin:0;
font-family:Arial;
background:#111;
color:white;
background-size:cover;
background-position:center;
transition:0.5s;
text-align:center;
}

button{
padding:6px 12px;
margin:5px;
border:none;
border-radius:5px;
cursor:pointer;
}

#subject{font-size:40px;margin-top:15vh;}
#remaining{font-size:30px;margin-top:10px;}
#warningBox{margin-top:20px;}
.red{color:red;}
.orange{color:orange;}
</style>
</head>

<body>

<div id="clock" style="font-size:60px;margin-top:40px;"></div>

<div id="subject"></div>
<div id="remaining"></div>

<div id="warningBox" style="display:none;"></div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbzxGq0YZIQRoMl1idQrUjbv-6jiVmu4ekawjFiIEc4F4KnHaLxm2tZruLzKXxDXUr977A/exec";

/* CLOCK */
setInterval(()=>{
const now=new Date();
document.getElementById("clock").innerText=now.toLocaleTimeString();
},1000);
<div style="position:absolute; top:10px; left:10px;">
  <a href="./admin.html">
    <button style="font-size:12px;">ADMIN</button>
  </a>
</div>
/* WALLPAPER */
function changeWallpaper(){
const url="https://picsum.photos/1600/900?random="+new Date().getTime();
document.body.style.backgroundImage="url('"+url+"')";
}
changeWallpaper();
setInterval(changeWallpaper,900000);

/* ROUTINE LOAD */
let routine=JSON.parse(localStorage.getItem("routine"))||[];

let activeIndex=-1;
let studyTimer;
let warningTimer;
let warningSeconds=0;
let studySeconds=0;

/* CHECK SCHEDULE */
setInterval(checkSchedule,1000);

function checkSchedule(){

const now=new Date();
const currentTime=
String(now.getHours()).padStart(2,"0")+":"+
String(now.getMinutes()).padStart(2,"0");

routine.forEach((item,index)=>{

let [h,m]=item.time.split(":");
let startDate=new Date();
startDate.setHours(h);
startDate.setMinutes(m);
startDate.setSeconds(0);

let diff=Math.floor((startDate-now)/60000);

/* 10 MIN BEFORE START */
if(diff===10 && activeIndex!==index){
showPreWarning(index,item);
}

});

}

/* PRE WARNING */
function showPreWarning(index,item){

activeIndex=index;
warningSeconds=600;

document.getElementById("subject").innerText=
"Upcoming: "+item.subject;

document.getElementById("subject").classList.remove("red");
document.getElementById("subject").classList.add("orange");

document.getElementById("warningBox").style.display="block";

document.getElementById("warningBox").innerHTML=
"âš  "+item.subject+" starting in 10 min<br><br>"+
"<button onclick='startNow()'>Start</button>"+
"<button onclick='cancelNow()'>Cancel</button>"+
"<button onclick='sameSubject()'>Same Subject</button>";

/* TELEGRAM SEND */
fetch(scriptURL,{
method:"POST",
body:new URLSearchParams({
type:"warning",
subject:item.subject,
message:"Starting in 10 Minutes"
})
});

/* WARNING COUNTDOWN */
clearInterval(warningTimer);

warningTimer=setInterval(()=>{

warningSeconds--;

let m=Math.floor(warningSeconds/60);
let s=warningSeconds%60;

document.getElementById("remaining").innerText=
"Warning: "+m+":"+String(s).padStart(2,"0");

if(warningSeconds<=0){
clearInterval(warningTimer);
cancelNow();
}

},1000);

}

/* START BUTTON */
function startNow(){

clearInterval(warningTimer);
document.getElementById("warningBox").style.display="none";

startStudy(routine[activeIndex]);

}

/* SAME SUBJECT */
function sameSubject(){

clearInterval(warningTimer);
document.getElementById("warningBox").style.display="none";

startStudy(routine[activeIndex]);

}

/* CANCEL */
function cancelNow(){

clearInterval(warningTimer);
clearInterval(studyTimer);

document.getElementById("subject").innerText="CANCELLED";
document.getElementById("subject").classList.remove("orange");
document.getElementById("subject").classList.add("red");

document.getElementById("remaining").innerText="";
document.getElementById("warningBox").style.display="none";

}

/* STUDY TIMER */
function startStudy(item){

studySeconds=item.duration*60;

document.getElementById("subject").innerText=item.subject;
document.getElementById("subject").classList.remove("orange");
document.getElementById("subject").classList.remove("red");

clearInterval(studyTimer);

studyTimer=setInterval(()=>{

studySeconds--;

let m=Math.floor(studySeconds/60);
let s=studySeconds%60;

document.getElementById("remaining").innerText=
"Study: "+m+":"+String(s).padStart(2,"0");

if(studySeconds<=0){
clearInterval(studyTimer);
cancelNow();
}

},1000);

}

</script>

</body>
</html>
