<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study ULTIMATE</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
overflow-x:hidden;
transition:0.4s;
}

/* Glass Card */
.card{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(15px);
border-radius:20px;
padding:25px;
margin:20px;
box-shadow:0 0 30px rgba(0,0,0,0.4);
}

/* Buttons */
button{
padding:8px 18px;
border:none;
border-radius:10px;
cursor:pointer;
background:#1f1f1f;
color:white;
transition:0.3s;
}
button:hover{
background:#444;
}

h2{margin-left:20px;margin-top:20px;}

#dashboard{padding-bottom:50px;}

.big{font-size:26px;font-weight:bold;}
.small{color:#bbb;}

#tabMode{
display:none;
height:100vh;
background-size:cover;
background-position:center;
text-align:center;
position:relative;
animation:fadeIn 0.6s ease;
}

@keyframes fadeIn{
from{opacity:0;}
to{opacity:1;}
}

#clockBig{font-size:80px;margin-top:40px;}
#subjectBig{font-size:50px;margin-top:18vh;}
#remainBig{font-size:32px;margin-top:10px;}
.orange{color:orange;}
.red{color:red;}

#exitBtn{
position:absolute;
bottom:20px;
right:25px;
background:rgba(0,0,0,0.6);
font-size:12px;
}

@media(max-width:768px){
#clockBig{font-size:45px;}
#subjectBig{font-size:28px;}
}
</style>
</head>

<body>

<h2>Smart Study Dashboard</h2>

<div id="dashboard">

<div class="card">
<div class="big" id="liveTime"></div>
<div class="small" id="liveDate"></div>
</div>

<div class="card">
<div class="big">Study Analytics</div>
<canvas id="chart"></canvas>
</div>

<div style="margin-left:20px;">
<button onclick="enterTab()">Enter Tab Mode</button>
<a href="admin.html"><button>Admin</button></a>
</div>

</div>

<!-- TAB MODE -->
<div id="tabMode">
<div id="clockBig"></div>
<div id="subjectBig"></div>
<div id="remainBig"></div>
<div id="warningBox"></div>
<button id="exitBtn" onclick="exitTab()">EXIT</button>
</div>

<script>

const scriptURL="YOUR_WEB_APP_URL";

/* CLOCK */
setInterval(()=>{
let now=new Date();
document.getElementById("liveTime").innerText=now.toLocaleTimeString();
document.getElementById("liveDate").innerText=now.toDateString();
document.getElementById("clockBig").innerText=now.toLocaleTimeString();
},1000);

/* AUTO WALLPAPER (STABLE SOURCE) */
function changeWallpaper(){
document.getElementById("tabMode").style.backgroundImage =
"url('https://source.unsplash.com/1600x900/?nature,study&"+Date.now()+"')";
}
changeWallpaper();
setInterval(changeWallpaper,900000);

/* REAL SHEET GRAPH */
fetch(scriptURL+"?action=sheet")
.then(res=>res.json())
.then(data=>{

if(!Array.isArray(data)){return;}

let labels=data.map(r=>r[0]);
let values=data.map(r=>parseFloat(r[1])||0);

new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:labels,
datasets:[{
label:"Study Hours",
data:values,
backgroundColor:"rgba(0,150,255,0.6)"
}]
},
options:{
responsive:true,
plugins:{legend:{display:false}}
}
});

})
.catch(err=>{
console.log("Graph error:",err);
});

/* ROUTINE */
let routine=[];
try{routine=JSON.parse(localStorage.getItem("routine"))||[];}catch(e){}

let activeIndex=-1;
let studyTimer;

setInterval(checkSchedule,1000);

function checkSchedule(){

let now=new Date();

routine.forEach((item,index)=>{

let start=new Date();
let [h,m]=item.time.split(":");
start.setHours(h);
start.setMinutes(m);
start.setSeconds(0);

let diff=Math.floor((start-now)/60000);

if(diff===10 && activeIndex!==index){
preWarning(index,item);
}

});

}

function preWarning(index,item){

activeIndex=index;

document.getElementById("subjectBig").innerText="Upcoming: "+item.subject;
document.getElementById("subjectBig").className="orange";

document.getElementById("warningBox").innerHTML=
"<button onclick='startNow()'>Start</button>"+
"<button onclick='cancelNow()'>Cancel</button>"+
"<button onclick='sameSubject()'>Same</button>";

fetch(scriptURL,{
method:"POST",
body:new URLSearchParams({
type:"warning",
subject:item.subject,
message:"Starting in 10 Minutes"
})
});

}

function startNow(){
startStudy(routine[activeIndex]);
}

function sameSubject(){
startStudy(routine[activeIndex]);
}

function cancelNow(){
document.getElementById("subjectBig").innerText="CANCELLED";
document.getElementById("subjectBig").className="red";
document.getElementById("remainBig").innerText="";
}

function startStudy(item){

setWallpaperBySubject(item.subject);

let seconds=item.duration*60;

studyTimer=setInterval(()=>{

seconds--;

let m=Math.floor(seconds/60);
let s=seconds%60;

document.getElementById("subjectBig").innerText=item.subject;
document.getElementById("remainBig").innerText=
m+":"+String(s).padStart(2,"0");

if(seconds<=0){
cancelNow();
}

},1000);

}

function setWallpaperBySubject(subject){

let map={
Math:"math,blackboard",
English:"books,library",
GS:"history,map",
Reasoning:"logic,puzzle"
};

document.getElementById("tabMode").style.backgroundImage=
"url('https://source.unsplash.com/1600x900/?"+
(map[subject]||"study,nature")+
"&"+Date.now()+"')";
}

function enterTab(){
document.getElementById("dashboard").style.display="none";
document.getElementById("tabMode").style.display="block";
}

function exitTab(){
document.getElementById("dashboard").style.display="block";
document.getElementById("tabMode").style.display="none";
}

</script>
</body>
</html>
