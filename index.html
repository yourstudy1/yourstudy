<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study Final</title>
<style>
body{margin:0;font-family:Segoe UI;background:#111;color:white;}
#tabMode{position:fixed;top:0;left:0;width:100vw;height:100vh;
background-size:cover;background-position:center;text-align:center;}
.overlay{background:rgba(0,0,0,0.7);height:100%;padding-top:40px;}
#time{font-size:90px;}
#subject{font-size:60px;margin-top:40px;}
#warningTimer{font-size:35px;color:orange;}
#studyTimer{font-size:40px;}
</style>
</head>
<body>

<div id="tabMode">
<div class="overlay">
<div id="time"></div>
<div id="subject"></div>
<div id="warningTimer"></div>
<div id="studyTimer"></div>
</div>
</div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbzBSTQReMLXT1Bk-301B1fxF0Ak8BTgRTNZWty1TZ_AXAtxFI_3f_faSN70voQ7sIppug/exec";

/* CLOCK */
setInterval(()=>{
document.getElementById("time").innerText=
new Date().toLocaleTimeString();
},1000);

/* TELEGRAM SYNC */
let currentMode="normal";
let studyInterval;
let studySeconds=0;

setInterval(()=>{
fetch(scriptURL+"?action=status")
.then(res=>res.json())
.then(data=>{

if(data.mode) currentMode=data.mode;

if(data.action==="cancel") cancelStudy();
if(data.action==="start") startStudy(25);
if(data.action==="same") startStudy(25);
if(data.extend) studySeconds+=parseInt(data.extend)*60;

});
},2000);

/* WARNING SYSTEM */
function triggerWarning(subject){

fetch(scriptURL+"?action=warning&subject="+subject);

let seconds=600;

let warningInterval=setInterval(()=>{
seconds--;
let m=Math.floor(seconds/60);
let s=seconds%60;
document.getElementById("subject").innerText="Upcoming: "+subject;
document.getElementById("warningTimer").innerText=
"Warning: "+m+":"+String(s).padStart(2,"0");

if(seconds<=0){
clearInterval(warningInterval);
startStudy(25);
}
},1000);
}

/* STUDY */
function startStudy(minutes){

studySeconds=minutes*60;

clearInterval(studyInterval);

studyInterval=setInterval(()=>{
studySeconds--;
let m=Math.floor(studySeconds/60);
let s=studySeconds%60;

document.getElementById("subject").innerText="STUDYING";
document.getElementById("warningTimer").innerText="";
document.getElementById("studyTimer").innerText=
m+":"+String(s).padStart(2,"0");

if(studySeconds<=0) cancelStudy();
},1000);
}

function cancelStudy(){
clearInterval(studyInterval);
document.getElementById("studyTimer").innerText="";
document.getElementById("subject").innerText="CANCELLED";
}

/* AUTO TEST WARNING */
setTimeout(()=>triggerWarning("Math"),5000);

</script>
</body>
</html>
