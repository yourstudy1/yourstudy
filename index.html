<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study Final Structure</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:#111;
color:white;
}

/* DASHBOARD */
#dashboard{
padding:20px;
}

.card{
background:rgba(255,255,255,0.08);
padding:20px;
border-radius:15px;
margin-bottom:15px;
backdrop-filter:blur(10px);
}

button{
padding:8px 15px;
border:none;
border-radius:8px;
cursor:pointer;
background:#333;
color:white;
}

/* TAB MODE */
#tabMode{
display:none;
height:100vh;
background-size:cover;
background-position:center;
text-align:center;
position:relative;
}

.overlay{
background:rgba(0,0,0,0.7);
height:100%;
padding-top:30px;
}

#time{font-size:60px;}
#date{font-size:20px;}
#temp{margin-top:5px;}
#customBox{margin-top:10px;font-size:22px;}
#subject{font-size:45px;margin-top:20px;}
#warningTimer{font-size:25px;color:orange;}
#studyTimer{font-size:30px;}
#nextSubject{margin-top:10px;font-size:18px;}

.red{color:red;}
.orange{color:orange;}
</style>
</head>

<body>

<!-- DASHBOARD -->
<div id="dashboard">

<h2>Study Dashboard</h2>

<div class="card">
<canvas id="studyChart"></canvas>
</div>

<div class="card">
<div id="todayTotal"></div>
</div>

<button onclick="enterTab()">Enter Tab Mode</button>
<a href="admin.html"><button>Admin</button></a>

</div>

<!-- TAB MODE -->
<div id="tabMode">
<div class="overlay">

<div id="time"></div>
<div id="date"></div>
<div id="temp"></div>
<div id="customBox"></div>

<div id="subject"></div>
<div id="warningTimer"></div>
<div id="studyTimer"></div>
<div id="nextSubject"></div>

<button onclick="cancelStudy()">Cancel</button>
<button onclick="exitTab()">Exit</button>

</div>
</div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbwNOOoUixPcRWeMjIv9C2TgqEREVtoFhlOwqnkn2QJt2OZluQyvju5SaBXNhnN_KHsQTQ/exec";

/* ===== WALLPAPER AUTO 15 MIN ===== */
function changeWallpaper(){
const url="https://picsum.photos/1920/1080?random="+Date.now();
document.getElementById("tabMode").style.backgroundImage="url('"+url+"')";
}
changeWallpaper();
setInterval(changeWallpaper,900000);

/* ===== CLOCK + DATE ===== */
setInterval(()=>{
let now=new Date();
document.getElementById("time").innerText=now.toLocaleTimeString();
document.getElementById("date").innerText=now.toDateString();
},1000);

/* ===== TEMPERATURE ===== */
fetch("https://api.open-meteo.com/v1/forecast?latitude=23.5&longitude=87.3&current_weather=true")
.then(res=>res.json())
.then(data=>{
document.getElementById("temp").innerText=
"Temperature: "+data.current_weather.temperature+"Â°C";
});

/* ===== COLOR CHANGE (ADMIN) ===== */
setInterval(()=>{
let color=localStorage.getItem("textColor")||"white";
document.getElementById("time").style.color=color;
},1000);

/* ===== CUSTOM NOTIFICATION ===== */
setInterval(()=>{
let data=JSON.parse(localStorage.getItem("customNotification"));
if(data && Date.now()<data.expire){
document.getElementById("customBox").innerText=data.message;
}else{
document.getElementById("customBox").innerText="";
}
},1000);

/* ===== ROUTINE ===== */
let routine=[];
try{routine=JSON.parse(localStorage.getItem("routine"))||[];}catch(e){}

let activeIndex=-1;
let warningInterval;
let studyInterval;

/* CHECK EVERY SECOND */
setInterval(checkSchedule,1000);

function checkSchedule(){
let now=new Date();

routine.forEach((item,index)=>{

let start=new Date();
let
